!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o(o.s=2)}([function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));const n=new Promise((function(t){"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?t():document.addEventListener("DOMContentLoaded",t)}))},,function(t,e,o){"use strict";o.r(e);var n=o(0);window.onbeforeunload=function(){window.scrollTo(0,0)},ko.bindingHandlers.highstock={update:function(t,e,o){var n=ko.unwrap(e()),r=null!=n&&null!=n.options?n.options:n;Highcharts.stockChart(t,r)}};const r=t=>new Promise((e,o)=>{const n=t.map(({criteria:t={}})=>{const{state:e=!1,county:o=!1}=t;let n="";return e&&(n=`?state=${e}`+(o?`&county=${o}`:"")),r=`/historical/data.json${n}`,new Promise(t=>{Highcharts.getJSON(r,e=>{t(e)})});var r});return Promise.all(n).then(n=>{const r=n.map((e,n)=>{const r=t[n].key,{error:s=!1,rows:a=[]}=e;return s?o(s):{name:r,data:a.map(t=>[new Date(t.date.split("T")[0]).getTime(),parseInt(t.cases)]),tooltip:{valueDecimals:0}}});return e({options:{rangeSelector:{selected:1},title:{text:null},series:r}})})}),s=({state:t=!1}={})=>new Promise((e,o)=>{const n=t?`?state=${t}`:"";Highcharts.getJSON(`/historical/drill-down-options.json${n}`,({rows:t=null,error:n=!1})=>{if(n)return o(n);e(t)})});class a{constructor(t,e){var o=this;this.selectedTickers=ko.observableArray([{key:this.constructor.US_TICKER_KEY}]),this.options=ko.observable(t),this.state=ko.observable(!1),this.county=ko.observable(!1),this.stateOptions=ko.observableArray(e),this.countyOptions=ko.observableArray([]),this.hasCountyOptions=ko.computed(()=>this.countyOptions().length>0),window.model=this,this.onAdd=function(t,e){o.populateData()},this.onRemoveTicker=function(t,e){const n=e.currentTarget.getAttribute("data-key"),r=o.selectedTickers().findIndex(t=>t.key==n);o.selectedTickers.splice(r,1),o.refreshChart(o.selectedTickers())},this.onDrillDown=function(t,e){e.preventDefault(),e.stopPropagation();const n=t.state();if(!n)return alert("Please select a state/territory"),!1;s({state:n}).then(t=>{o.countyOptions(t)}).catch(()=>alert("Fail to load  drill down options, please try again"))},this.onFormClear=function(t,e){e.preventDefault(),e.stopPropagation(),o.state(void 0),o.county(!1),o.countyOptions([]),o.selectedTickers([]),o.populateData()},this.onStateChange=function(t,e){o.county(null),o.countyOptions([])},this.populateData=function(){const t=o.state(),e=o.county(),n=o.selectedTickers();let r={};if(r=t&&!e?{key:t,criteria:{state:t}}:t&&e?{key:`${e}, ${t}`,criteria:{state:t,county:e}}:{key:o.constructor.US_TICKER_KEY},n.some(t=>t.key==r.key))return alert(`${r.key} is already in the chart`),!1;n.push(r),o.refreshChart(n)},this.refreshChart=t=>{r(t).then(({options:e})=>{o.options(e),o.selectedTickers(t)}).catch(t=>{alert("Fail to load data for rendering the chart. Please try again!"),console&&console.log(t)})}}}a.US_TICKER_KEY="US Nationwide",n.a.then((function(){Promise.all([r([{key:a.US_TICKER_KEY}]),s()]).then(([{options:t},e])=>{var o=new a(t,e);ko.applyBindings(o,document.getElementById("app"))}).catch(t=>{alert("Sorry, error encountered, please try again!"),console&&console.log(t)})}))}]);
//# sourceMappingURL=historical.js.map