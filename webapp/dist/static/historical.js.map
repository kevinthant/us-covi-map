{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./static/on-ready.js","webpack:///./static/historical.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","onReady","Promise","resolve","document","readyState","documentElement","doScroll","addEventListener","window","onbeforeunload","scrollTo","ko","bindingHandlers","highstock","update","element","valueAccessor","allBindingsAccessor","unwrap","options","Highcharts","stockChart","getChartData","tickers","reject","requests","map","criteria","state","county","query","url","getJSON","response","all","then","results","series","result","error","rows","data","item","Date","date","split","getTime","parseInt","cases","tooltip","valueDecimals","rangeSelector","selected","title","text","getDdlOptions","HistoricalChartModel","constructor","stateOptions","self","this","selectedTickers","observableArray","US_TICKER_KEY","observable","countyOptions","hasCountyOptions","computed","length","model","onAdd","v","e","populateData","onRemoveTicker","currentTarget","getAttribute","findIndex","splice","refreshChart","onDrillDown","preventDefault","stopPropagation","alert","catch","onFormClear","undefined","onStateChange","newTicker","some","x","push","err","console","log","applyBindings","getElementById"],"mappings":"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","file":"static/historical.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","const onReady = new Promise(function(resolve){\n  if (\n      document.readyState === \"complete\" ||\n      (document.readyState !== \"loading\" && !document.documentElement.doScroll)\n  ) {\n    resolve();\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", resolve);\n  }\n});\n\nexport default { \n  onReady \n};\n\nexport { \n  onReady \n};","\nimport { onReady } from './on-ready';\n\nwindow.onbeforeunload = function () {\n  window.scrollTo(0, 0);\n}\n\nko.bindingHandlers.highstock = {\n  update: function(element, valueAccessor, allBindingsAccessor) {\n    var value = ko.unwrap(valueAccessor());\n\t\tvar options = (value!=null) && (value.options!= null) ? value.options : value;\n    Highcharts.stockChart(element, options);\n  }\n};\n\nconst getJSON = (url) => {\n  return new Promise((resolve) => {\n    Highcharts.getJSON(url, (response) => {\n      resolve(response);\n    });\n  });\n};\n\nconst getChartData = (tickers) => {\n  return new Promise((resolve, reject) => {\n\n    const requests = tickers.map(({ criteria = { }}) => {\n      const { state = false, county = false } = criteria;\n      let query = '';\n      if(state) {\n        query = `?state=${state}` + (county ? `&county=${county}` : '');\n      }\n\n      return getJSON(`/historical/data.json${query}`);\n    });\n\n    return Promise.all(requests).then((results) => {\n\n      const series = results.map((result, i) => {\n        const name = tickers[i].key;\n        const { error = false, rows  = []} = result;\n        if(error) {\n          return reject(error);\n        }\n  \n        const data = rows.map((item) => {\n          const date = new Date(item.date.split('T')[0]);\n          return [date.getTime(), parseInt(item.cases)];\n        });\n\n        return {\n          name,\n          data,\n          tooltip: {\n            valueDecimals: 0\n          }\n        };\n      });\n\n      const options = {\n        rangeSelector: {\n          selected: 1\n        },\n        title: {\n          text: null\n        },\n        series,\n      };\n\n      return resolve({ options });\n    });\n  });\n};\n\nconst getDdlOptions = ({ state = false } = {}) => {\n  return new Promise((resolve, reject) => {\n    const query = state ? `?state=${state}` : '';\n    Highcharts.getJSON(`/historical/drill-down-options.json${query}`, ({ rows = null, error = false }) => {\n      if(error) {\n        return reject(error);\n      }\n\n      resolve(rows);\n    });\n  });\n};\n\nclass HistoricalChartModel {\n  constructor(options, stateOptions) {\n    var self = this;\n    this.selectedTickers = ko.observableArray([{ key: this.constructor.US_TICKER_KEY }]);\n    this.options = ko.observable(options);\n    this.state = ko.observable(false);\n    this.county = ko.observable(false);\n    this.stateOptions = ko.observableArray(stateOptions);\n    this.countyOptions = ko.observableArray([]);\n    this.hasCountyOptions = ko.computed(() => {\n      return this.countyOptions().length > 0;\n    });\n    window.model = this;\n\n    this.onAdd = function(v, e) {\n\n      self.populateData();\n    };\n\n    this.onRemoveTicker = function(v, e) {\n      const key = e.currentTarget.getAttribute('data-key');\n      const i = self.selectedTickers().findIndex((t) => t.key == key);\n      self.selectedTickers.splice(i, 1);\n      self.refreshChart(self.selectedTickers());\n    };\n\n    this.onDrillDown = function(v, e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const state = v.state();\n      if(!state) {\n        alert('Please select a state/territory');\n        return false;\n      }\n\n      getDdlOptions({ state })\n      .then((options) => {\n        self.countyOptions(options);\n      })\n      .catch(() => alert('Fail to load  drill down options, please try again'));\n    };\n\n    this.onFormClear = function(v, e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      self.state(undefined);\n      self.county(false);\n      self.countyOptions([]);\n      self.selectedTickers([]);\n      self.populateData();\n    };\n\n    this.onStateChange = function(v, e) {\n      self.county(null);\n      self.countyOptions([]);\n    };\n\n    this.populateData = function() {\n      const state = self.state();\n      const county = self.county();\n      const selectedTickers = self.selectedTickers();\n      let newTicker = {};\n\n      if(state && !county) {\n        newTicker = { key: state, criteria: { state }};\n      } else if(state && county) {\n        newTicker = { key: `${county}, ${state}`, criteria: { state, county }};\n      } else {\n        newTicker = { key: self.constructor.US_TICKER_KEY };\n      }\n\n      if(selectedTickers.some((x) => x.key == newTicker.key)) {\n        alert(`${newTicker.key} is already in the chart`);\n        return false;\n      }\n\n      selectedTickers.push(newTicker);\n      self.refreshChart(selectedTickers);\n    };\n\n    this.refreshChart  = (selectedTickers) => {\n      getChartData(selectedTickers)\n        .then(({ options }) => {\n          self.options(options);\n          self.selectedTickers(selectedTickers);\n        })\n        .catch((err) => {\n          alert('Fail to load data for rendering the chart. Please try again!');\n          console && console.log(err);\n        });\n    };\n  }\n}\n\nHistoricalChartModel.US_TICKER_KEY = 'US Nationwide';\n\nfunction initChart() {\n  Promise.all([getChartData([{ key: HistoricalChartModel.US_TICKER_KEY }]), getDdlOptions()]).then(([{ options }, stateOptions]) => {\n    var model = new HistoricalChartModel(options, stateOptions);\n    ko.applyBindings(model, document.getElementById('app'));\n  })\n  .catch((err) => {\n    alert('Sorry, error encountered, please try again!');\n    console && console.log(err);\n  });\n}\n\nonReady.then(initChart);\n\n"],"sourceRoot":""}